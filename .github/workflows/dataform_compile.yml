name: DF-COMPILE

on:
  push:
    branches:
      - master
#   pull_request:
#     branches:
#       - master

jobs:
  compile:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code into workspace directory
        uses: actions/checkout@v2
      - name: Install project dependencies
        uses: docker://dataformco/dataform:1.6.11
        with:
          args: install
      - name: Run dataform compile
        uses: docker://dataformco/dataform:1.6.11
        with:
          args: compile
          
      - name: action-slack
        # You may pin to the exact commit or the version.
        # uses: 8398a7/action-slack@b6a4c791ce0c137843eb11e038f855cf567014dc
        uses: 8398a7/action-slack@v3.8.2
        
        with:
          # Specify success or failure or cancelled or custom.
          status: ${{ job.status }}
          # You can choose the items you want to add to the fields at the time of notification.
          #   If you have more than one, please enter it in csv format.
          #   e.g. commit,repo

          fields: all # optional, default is 
          # json payload
          # refs https://github.com/slackapi/node-slack-sdk/blob/v5.0.0/packages/webhook/src/IncomingWebhook.ts#L91-L106)

          custom_payload: here # optional
          # Specify channel or here or `user_id`.
          # refs: https://api.slack.com/reference/surfaces/formatting#mentioning-users

#           mention: # optional, default is 
#           # Specify success or failure or cancelled or custom or always.
#           # Multiple statuses can be specified in csv format.
#           # e.g. success,failure

#           if_mention: # optional, default is 
#           # User name for slack notification.

#           author_name: # optional, default is 8398a7@action-slack
#           # You can overwrite text.

#           text: # optional, default is 
#           # override the legacy integration's default name.

#           username: # optional, default is 
#           # an emoji code string to use in place of the default icon.

#           icon_emoji: # optional, default is 
#           # an icon image URL string to use in place of the default icon.

#           icon_url: # optional, default is 
#           # override the legacy integration's default channel. This should be an ID, such as C8UJ12P4P.

#           channel: # optional, default is 
#           # Use this if you want to overwrite the job name.

#           job_name: # optional, default is 
#           # Use this if you wish to use a different GitHub token than the one provided by the workflow.

#           github_token: # default is ${{ github.token }}
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }} # required
        if: always() # Pick up events even if the job fails or is canceled.
